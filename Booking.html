<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Wash Appointment Booking</title>
    <link rel="stylesheet" href="style.css"> <!-- Assuming your CSS is linked here -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link rel="icon" href="me_oWV_icon.ico" type="image/x-icon">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Header Section -->
    <div class="header-container">
        <div class="left-container">
            <div class="logo-container">
                <span class="logo">Mr.Bams MobileCarWash</span>
            </div>
            <h1>Try Us Now</h1>
            <p>We bring the car wash to your doorstep. Convenient, reliable, professional, and affordable car wash services.</p>
        </div>
        <div class="right-container">
            <h2>Book a Car Wash Appointment</h2>
            <p>Click the Button Below to make a Booking with Mr.Bam Mobile Car Wash.</p>
            <!-- Book Now Button -->
            <button class="service-btn" onclick="openPopup()">
                <i class="fas fa-car custom-car-icon"></i> Book Now
            </button>
        </div>
    </div>

   <!-- Include EmailJS SDK -->
<script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>

<script>
    // Initialize EmailJS with your user ID
    emailjs.init("YOUR_USER_ID"); // Replace with your EmailJS User ID

    // Function to open the popup form
    function openPopup() {
        document.getElementById("popup-form").style.display = "flex";
    }

    // Function to close the popup form
    function closePopup() {
        document.getElementById("popup-form").style.display = "none";
    }

    // Handle form submission
    document.getElementById("appointment-form").addEventListener("submit", function (e) {
        e.preventDefault();

        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const service = document.getElementById("service").value;
        const location = document.getElementById("location").value;
        const date = document.getElementById("date").value;
        const time = document.getElementById("time").value;
        const message = document.getElementById("message").value;

        // Generate the invoice PDF using jsPDF
        generateInvoice(name, service, location, date, time);

        // Send email notification to the user
        sendEmailNotification(name, email, service, location, date, time);

        // Close the popup form after submission
        closePopup();
    });

    // Function to generate invoice (existing code, unchanged)
    function generateInvoice(name, service, location, date, time) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Generate a random invoice number
        const invoiceNumber = `INV-${Math.floor(Math.random() * 1000000)}`;

        const logoUrl = 'me.jpg'; // Path to your logo JPG file (local or hosted image)

        // Define logo position and size
        const logoX = 20;
        const logoY = 34;
        const logoWidth = 30;
        const logoHeight = 30;
        const logoBorderRadius = 30;

        // Draw the rounded logo background
        doc.setFillColor(255, 255, 255);
        doc.roundedRect(logoX, logoY, logoWidth, logoHeight, logoBorderRadius, logoBorderRadius, 'F');
        doc.addImage(logoUrl, 'JPEG', logoX, logoY, logoWidth, logoHeight);

        // Set font and text for invoice title and number
        doc.setFontSize(18);
        doc.text("Invoice - Mr.Bams Mobile Car Wash", 105, 50, null, null, "center");
        doc.setFontSize(12);
        doc.text(`Invoice No: ${invoiceNumber}`, 105, 60);

        // Additional invoice content...
        const totalAmount = getPrice(service);
        doc.text("Total: R" + totalAmount, 105, 150);

        // Save the invoice as a PDF
        doc.save("invoice.pdf");

        // Notify the user that the invoice is ready
        alert("Booking confirmed! Check your invoice.");
    }

    function getPrice(service) {
        let price = 0;
        if (service === "interior") price = 300;
        else if (service === "exterior") price = 250;
        else if (service === "full") price = 500;
        return price;
    }

    // Function to send email notification using EmailJS
    function sendEmailNotification(name, email, service, location, date, time) {
        // Email parameters to send to the client
        const emailParams = {
            name: name,
            email: email,
            service: service,
            location: location,
            date: date,
            time: time,
            invoice_number: `INV-${Math.floor(Math.random() * 1000000)}`  // Random invoice number
        };

        // Send email to the client
        emailjs.send("gmail", "CarWashBooking", emailParams)
            .then(function(response) {
                console.log("Client email sent successfully", response);
            }, function(error) {
                console.error("Error sending client email", error);
            });

        // Send email to the admin
        emailParams.email = "mrbamsmobilecarwash1@gmail.com"; 
        emailjs.send("gmail", "ClientBookings", emailParams)
            .then(function(response) {
                console.log("Admin email sent successfully", response);
            }, function(error) {
                console.error("Error sending admin email", error);
            });
    }
</script>

</body>
</html>
